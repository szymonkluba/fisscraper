<!--suppress JSUnusedGlobalSymbols -->
<h2>Archive directories:</h2>

<mat-divider></mat-divider>
<app-loading-spinner
  [isLoading]="(foldersLoadStatus$ | async) === false"></app-loading-spinner>
<ng-container *ngIf="folders$ | async as folders">
  <mat-accordion class="accordion" multi>
    <mat-expansion-panel *ngFor="let folder of folders; trackBy: trackByIndex">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon [svgIcon]="icons.folder"></mat-icon>
          <span>
            {{ folder.name }}
          </span>
        </mat-panel-title>
        <mat-panel-description>
          <button
            mat-icon-button
            (click)="$event.stopPropagation(); downloadFolder(folder.entries)">
            <mat-icon> download </mat-icon>
          </button>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <table mat-table [dataSource]="folder.entries" multiTemplateDataRows>
        <ng-container
          *ngFor="let column of displayedColumns; trackBy: trackByIndex"
          [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>
            {{ (column !== 'expand' ? column : '') | capitalize }}
          </th>
          <td mat-cell *matCellDef="let element">
            <app-folder-table-cell
              [item]="element"
              [key]="column"
              [expanded]="element === expandedElement"
              (downloadRaceEvent)="downloadRace($event)"
              (expandEvent)="expandRace($event)"></app-folder-table-cell>
          </td>
        </ng-container>
        <ng-container matColumnDef="expandedDetail">
          <td
            mat-cell
            *matCellDef="let element"
            [attr.colspan]="displayedColumns.length">
            <div
              class="detail-content"
              [@detailExpand]="
                element === expandedElement ? 'expanded' : 'collapsed'
              ">
              <app-archive-race-details
                *ngIf="expandedElement && element === expandedElement"
                [uuid]="expandedElement.uuid"></app-archive-race-details>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="element-row"
          [class.expanded-row]="expandedElement === row"
          (click)="expandedElement = expandedElement === row ? null : row"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: ['expandedDetail']"
          class="detail-row"></tr>
      </table>
    </mat-expansion-panel>
  </mat-accordion>
</ng-container>
