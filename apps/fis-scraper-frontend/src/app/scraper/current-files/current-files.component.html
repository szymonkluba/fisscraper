<ng-container *ngIf="files$ | async as files">
  <div class="current-files__header">
    <h2>Current files:</h2>
    <button
      *ngIf="files.length > 1 && races.selectedOptions.selected.length > 0"
      mat-button
      (click)="downloadAll(races.selectedOptions.selected)"
      matTooltip="Download all files as .zip">
      {{
        files.length > races.selectedOptions.selected.length
          ? 'DOWNLOAD SELECTED'
          : 'DOWNLOAD ALL'
      }}
      <mat-icon> download</mat-icon>
    </button>
  </div>
  <mat-progress-bar
    *ngIf="download$ | async as download"
    [mode]="download.state === 'PENDING' ? 'buffer' : 'determinate'"
    [value]="download.progress"
    [color]="
      download.state === 'DONE' || download.state === 'IN_PROGRES'
        ? 'accent'
        : 'warn'
    ">
  </mat-progress-bar>
  <mat-divider></mat-divider>
  <mat-selection-list #races>
    <div *ngFor="let file of files; trackBy: trackByUuid" class="option">
      <mat-list-option
        class="mat-elevation-z1 expanded"
        selected="true"
        [value]="file.uuid"
        @currentFileEnter>
        <mat-icon
          matListItemIcon
          [svgIcon]="
            file.kind === 'team' && !file.details ? 'zip_file' : 'csv_file'
          "></mat-icon>
        <div matListItemTitle>{{ file.place }} {{ file.hill_size }}</div>
        <div matListItemLine>{{ file.date | date: 'medium' }}</div>
      </mat-list-option>
      <button
        mat-icon-button
        (click)="downloadFile($event, file)"
        [matTooltip]="'Download ' + file.place + ' ' + file.hill_size">
        <mat-icon> download</mat-icon>
      </button>
    </div>
  </mat-selection-list>
  <app-file-spinner *ngIf="spinnerState$ | async"></app-file-spinner>
</ng-container>
